# Auto-generated Python bridge client
# DO NOT EDIT - This file is generated by the Soma SDK

from __future__ import annotations
import os
import httpx
from typing import Any, TYPE_CHECKING, TypeVar

if TYPE_CHECKING:
    from restate import ObjectContext

SOMA_SERVER_BASE_URL = os.environ.get("SOMA_SERVER_BASE_URL", "http://localhost:3000")

# Type variables for generic bridge function invocation
TParams = TypeVar("TParams", bound=dict[str, Any])
TResult = TypeVar("TResult")



async def _invoke_bridge_function(
    ctx: "ObjectContext",
    provider_instance_id: str,
    function_controller_type_id: str,
    params: TParams,
) -> TResult:
    """Internal helper to invoke a bridge function via the Soma API."""
    url = f"{SOMA_SERVER_BASE_URL}/api/bridge/v1/provider/{provider_instance_id}/function/{function_controller_type_id}/invoke"

    async def _make_request() -> TResult:
        async with httpx.AsyncClient() as client:
            response = await client.post(
                url,
                json=params,
                headers={"Content-Type": "application/json"},
            )
            response.raise_for_status()
            return response.json()

    # Use restate's run_typed() to make the call durable with proper typing
    return await ctx.run_typed("invoke_bridge_function", _make_request)




class Bridge:
    """Main bridge class providing access to all providers."""

    def __init__(self, ctx: "ObjectContext"):
        self._ctx = ctx



def get_bridge(ctx: "ObjectContext") -> Bridge:
    """Get a Bridge instance for the given Restate context."""
    return Bridge(ctx)

# Auto-generated Python bridge client
# DO NOT EDIT - This file is generated by the Soma SDK

from __future__ import annotations
import os
import httpx
from typing import TYPE_CHECKING, TypedDict, TypeVar, cast

if TYPE_CHECKING:
    from restate import ObjectContext

SOMA_SERVER_BASE_URL = os.environ.get("SOMA_SERVER_BASE_URL", "http://localhost:3000")

# Type variables for generic bridge function invocation
TParams = TypeVar("TParams")
TResult = TypeVar("TResult")




# Type definitions for ResearchClaim.research_claim params

class _ResearchClaimResearchClaimParamsClaim(TypedDict):


    amount: float

    category: str

    date: str

    email: str

    reason: str




class ResearchClaimResearchClaimParams(TypedDict):


    claim: _ResearchClaimResearchClaimParamsClaim




# Type definitions for ResearchClaim.research_claim result

class ResearchClaimResearchClaimResult(TypedDict):


    summary: str









# Type definitions for ApproveClaim.approve_claim params

class _ApproveClaimApproveClaimParamsClaim(TypedDict):


    amount: float

    category: str

    date: str

    email: str

    reason: str




class ApproveClaimApproveClaimParams(TypedDict):


    claim: _ApproveClaimApproveClaimParamsClaim




# Type definitions for ApproveClaim.approve_claim result

class ApproveClaimApproveClaimResult(TypedDict):


    approved: bool








async def _invoke_bridge_function(
    ctx: "ObjectContext",
    provider_instance_id: str,
    function_controller_type_id: str,
    params: TParams,
) -> TResult:
    """Internal helper to invoke a bridge function via the Soma API."""
    url = f"{SOMA_SERVER_BASE_URL}/api/bridge/v1/provider/{provider_instance_id}/function/{function_controller_type_id}/invoke"

    async def _make_request() -> TResult:
        async with httpx.AsyncClient() as client:
            response = await client.post(
                url,
                json=params,
                headers={"Content-Type": "application/json"},
            )
            response.raise_for_status()
            return cast(TResult, response.json())

    # Use restate's run_typed() to make the call durable with proper typing
    return await ctx.run_typed("invoke_bridge_function", _make_request)



class ResearchClaimAccount:
    """Account wrapper for research-claim provider."""

    def __init__(self, ctx: "ObjectContext", provider_instance_id: str):
        self._ctx = ctx
        self._provider_instance_id = provider_instance_id



    async def research_claim(self, params: ResearchClaimResearchClaimParams) -> ResearchClaimResearchClaimResult:
        """Call the research-claim function."""
        return await _invoke_bridge_function(
            self._ctx,
            self._provider_instance_id,
            "research-claim",
            params,
        )




class ResearchClaim:
    """Provider wrapper for research-claim."""

    def __init__(self, ctx: "ObjectContext"):
        self._ctx = ctx

        self.internal = ResearchClaimAccount(ctx, "452b1c4c-6ba7-4284-b362-2431750569fc")



class ApproveClaimAccount:
    """Account wrapper for approve-claim provider."""

    def __init__(self, ctx: "ObjectContext", provider_instance_id: str):
        self._ctx = ctx
        self._provider_instance_id = provider_instance_id



    async def approve_claim(self, params: ApproveClaimApproveClaimParams) -> ApproveClaimApproveClaimResult:
        """Call the approve-claim function."""
        return await _invoke_bridge_function(
            self._ctx,
            self._provider_instance_id,
            "approve-claim",
            params,
        )




class ApproveClaim:
    """Provider wrapper for approve-claim."""

    def __init__(self, ctx: "ObjectContext"):
        self._ctx = ctx

        self.internal = ApproveClaimAccount(ctx, "1b8c7dd2-45a9-4c82-8a9f-69cdb732883e")




class Bridge:
    """Main bridge class providing access to all providers."""

    def __init__(self, ctx: "ObjectContext"):
        self._ctx = ctx

        self.research_claim = ResearchClaim(ctx)

        self.approve_claim = ApproveClaim(ctx)



def get_bridge(ctx: "ObjectContext") -> Bridge:
    """Get a Bridge instance for the given Restate context."""
    return Bridge(ctx)

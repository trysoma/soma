// Auto-generated A2A Agent Clients
// Do not edit this file manually

import type { ObjectContext } from '@restatedev/restate-sdk';
import { A2AClient as BaseA2AClient } from '@a2a-js/sdk/client';
import {
  A2AClient,
  type AgentCard,
  type MessageSendParams,
  type SendMessageResponse,
  type TaskQueryParams,
  type GetTaskResponse,
  type TaskIdParams,
  type CancelTaskResponse,
  type Message,
  type Task,
  type TaskStatusUpdateEvent,
  type TaskArtifactUpdateEvent,
  type A2AStreamEventData
} from '@trysoma/sdk/a2a';

export interface AgentsConfig {
  SOMA_BASE_URL?: string;
}

{% for agent in agents %}
/**
 * Agent: {{ agent.name }}
 * Project: {{ agent.project_id }}
 * Description: {{ agent.description }}
 */
{% endfor %}

// Agent interface definitions
{% for project in projects %}
export interface {{ project.interface_name }}Agents {
  {% for agent in project.agents %}
  {{ agent.camel_case_id }}: A2AClient;
  {% endfor %}
}
{% endfor %}

export interface Agents {
  {% for project in projects %}
  {{ project.camel_case_id }}: {{ project.interface_name }}Agents;
  {% endfor %}
}

/**
 * Type alias for the agents definition.
 * Use this type when passing agents to pattern handlers.
 */
export type AgentsDefinition = Agents;

/**
 * Get all configured A2A agent clients, wrapped with Restate durability.
 *
 * @param ctx - The Restate ObjectContext for durability
 * @param config - Optional configuration including base URL
 * @returns An object containing all configured agents organized by project
 *
 * @example
 * ```typescript
 * const agents = await getAgents(ctx);
 *
 * // Send a message to an agent
 * const response = await agents.myProject.myAgent.sendMessage({
 *   message: {
 *     role: 'user',
 *     parts: [{ kind: 'text', text: 'Hello!' }],
 *     messageId: 'msg-123',
 *     kind: 'message'
 *   }
 * });
 *
 * // Stream responses from an agent
 * for await (const event of agents.myProject.myAgent.sendMessageStream({
 *   message: { ... }
 * })) {
 *   console.log('Received event:', event);
 * }
 * ```
 */
export async function getAgents(ctx: ObjectContext, config?: AgentsConfig): Promise<Agents> {
  const baseUrl = config?.SOMA_BASE_URL || process.env.SOMA_SERVER_BASE_URL || 'http://localhost:3000';

  // Initialize all A2A clients
  {% for agent in agents %}
  const {{ agent.var_name }}Client = await ctx.run('init-a2a-{{ agent.project_id }}-{{ agent.id }}', async () => {
    const cardUrl = `${baseUrl}/api/agent/{{ agent.project_id }}/{{ agent.id }}/a2a/.well-known/agent.json`;
    return BaseA2AClient.fromCardUrl(cardUrl);
  });
  const {{ agent.var_name }} = new A2AClient(ctx, {{ agent.var_name }}Client, '{{ agent.project_id }}.{{ agent.id }}');
  {% endfor %}

  return {
    {% for project in projects %}
    {{ project.camel_case_id }}: {
      {% for agent in project.agents %}
      {{ agent.camel_case_id }}: {{ agent.var_name }},
      {% endfor %}
    },
    {% endfor %}
  };
}

// Export types for external use
export type {
  AgentCard,
  MessageSendParams,
  SendMessageResponse,
  TaskQueryParams,
  GetTaskResponse,
  TaskIdParams,
  CancelTaskResponse,
  Message,
  Task,
  TaskStatusUpdateEvent,
  TaskArtifactUpdateEvent,
  A2AStreamEventData
};

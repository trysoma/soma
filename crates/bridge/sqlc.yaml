version: "2"
plugins:
  - name: sqlc-gen-from-template
    process:
      cmd: "./../../sqlc-gen-from-template"
sql:
  - engine: "sqlite"
    schema: "./migrations"
    queries: "./queries"
    codegen:
      - out: "src/repository/sqlite"
        plugin: "sqlc-gen-from-template"
        options:
          template: "./../../rust_rusqlite.go.tmpl"
          filename: "raw.generated.rs"
          cache_statements: true
          # optional formatter command to format generated code
          # the command needs to read from stdin and write to stdout
          # so rustfmt is not suitable
          #formatter_cmd: ""
          use_serde: true
          overrides:
            # resource_server_credential table
            - db_type: text
              column: resource_server_credential.id
              rust_type: "shared::primitives::WrappedUuidV4"
            - db_type: text
              column: resource_server_credential.credential_type
              rust_type: "crate::logic::ResourceServerCredentialType"
            - db_type: json
              column: resource_server_credential.credential_data
              rust_type: "shared::primitives::WrappedJsonValue"
            - db_type: json
              column: resource_server_credential.metadata
              rust_type: "shared::primitives::WrappedJsonValue"
            - db_type: datetime
              column: resource_server_credential.created_at
              rust_type: "shared::primitives::WrappedChronoDateTime"
            - db_type: datetime
              column: resource_server_credential.updated_at
              rust_type: "shared::primitives::WrappedChronoDateTime"
            
            - db_type: datetime
              column: user_credential.run_refresh_before
              rust_type: "shared::primitives::WrappedChronoDateTime"
            # user_credential table
            - db_type: text
              column: user_credential.id
              rust_type: "shared::primitives::WrappedUuidV4"
            - db_type: text
              column: user_credential.credential_type
              rust_type: "crate::logic::UserCredentialType"
            - db_type: json
              column: user_credential.credential_data
              rust_type: "shared::primitives::WrappedJsonValue"
            - db_type: json
              column: user_credential.metadata
              rust_type: "shared::primitives::WrappedJsonValue"
            - db_type: datetime
              column: user_credential.created_at
              rust_type: "shared::primitives::WrappedChronoDateTime"
            - db_type: datetime
              column: user_credential.updated_at
              rust_type: "shared::primitives::WrappedChronoDateTime"
            - db_type: datetime
              column: user_credential.run_refresh_before
              rust_type: "shared::primitives::WrappedChronoDateTime"
            # provider_instance table
            - db_type: text
              column: provider_instance.resource_server_credential_id
              rust_type: "shared::primitives::WrappedUuidV4"
            - db_type: text
              column: provider_instance.user_credential_id
              rust_type: "shared::primitives::WrappedUuidV4"
            - db_type: datetime
              column: provider_instance.created_at
              rust_type: "shared::primitives::WrappedChronoDateTime"
            - db_type: datetime
              column: provider_instance.updated_at
              rust_type: "shared::primitives::WrappedChronoDateTime"
            # function_instance table
            - db_type: datetime
              column: function_instance.created_at
              rust_type: "shared::primitives::WrappedChronoDateTime"
            - db_type: datetime
              column: function_instance.updated_at
              rust_type: "shared::primitives::WrappedChronoDateTime"
            # credential_exchange_state table
            - db_type: json
              column: credential_exchange_state.state
              rust_type: "crate::logic::Metadata"
            - db_type: datetime
              column: credential_exchange_state.created_at
              rust_type: "shared::primitives::WrappedChronoDateTime"
            - db_type: datetime
              column: credential_exchange_state.updated_at
              rust_type: "shared::primitives::WrappedChronoDateTime"